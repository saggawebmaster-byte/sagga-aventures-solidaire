# SystÃ¨me de RÃ´les et d'Authentification - Sagga

## ğŸ“‹ RÃ©sumÃ© des FonctionnalitÃ©s ImplÃ©mentÃ©es

### âœ… Authentification Better Auth
- **Email/Password** : Connexion et inscription par email
- **Base de donnÃ©es** : SQLite avec Prisma ORM
- **Sessions** : Gestion automatique des sessions utilisateur
- **Protection des routes** : Middleware pour protÃ©ger les pages

### âœ… SystÃ¨me de RÃ´les
- **Champ role** : AjoutÃ© au modÃ¨le User dans Prisma
- **RÃ´les disponibles** : `USER` (dÃ©faut) et `ADMIN`
- **Protection admin** : Page `/admin` rÃ©servÃ©e aux administrateurs
- **Composants de garde** : `AdminGuard` et `AdminLink`

### âœ… Interface Utilisateur
- **ThÃ¨me violet** : Couleur de charte #752D8B appliquÃ©e
- **Pages d'authentification** : Design moderne en split-screen
- **Navigation intelligente** : Lien admin visible seulement pour les administrateurs
- **Responsive design** : Interface adaptÃ©e mobile et desktop

## ğŸ—‚ï¸ Structure des Fichiers

### Authentification
```
lib/
â”œâ”€â”€ auth.ts                 # Configuration Better Auth
â”œâ”€â”€ auth-client.ts          # Utilities cÃ´tÃ© client
â””â”€â”€ auth-utils.ts           # Utilities de rÃ´les

app/auth/
â”œâ”€â”€ login/page.tsx          # Page de connexion
â””â”€â”€ register/page.tsx       # Page d'inscription

components/
â”œâ”€â”€ auth-layout.tsx         # Layout pour les pages auth
â”œâ”€â”€ admin-guard.tsx         # Protection des composants admin
â”œâ”€â”€ login-form.tsx          # Formulaire de connexion
â””â”€â”€ register-form.tsx       # Formulaire d'inscription
```

### Base de DonnÃ©es
```
prisma/
â”œâ”€â”€ schema.prisma           # SchÃ©ma avec modÃ¨les d'auth + role
â””â”€â”€ dev.db                  # Base SQLite

scripts/
â”œâ”€â”€ list-users.js           # Lister tous les utilisateurs
â”œâ”€â”€ make-admin.js           # Promouvoir un utilisateur admin
â””â”€â”€ test-roles.js           # Tester le systÃ¨me de rÃ´les
```

### Protection des Routes
```
middleware.ts               # Protection des routes protÃ©gÃ©es
app/admin/page.tsx          # Page admin avec AdminGuard
app/dashboard/page.tsx      # Page utilisateur connectÃ©
```

## ğŸš€ Utilisation

### CrÃ©er un Administrateur
```bash
# Promouvoir un utilisateur existant
node scripts/make-admin.js admin@example.com

# Lister tous les utilisateurs
node scripts/list-users.js

# Tester le systÃ¨me
node scripts/test-roles.js
```

### Protection d'une Page Admin
```tsx
import { AdminGuard } from '@/components/admin-guard';

export default function AdminPage() {
  return (
    <AdminGuard>
      {/* Contenu rÃ©servÃ© aux admins */}
    </AdminGuard>
  );
}
```

### Navigation Conditionnelle
```tsx
import { AdminLink } from '@/components/admin-guard';

function Navigation() {
  return (
    <nav>
      <AdminLink>
        <Link href="/admin">Administration</Link>
      </AdminLink>
    </nav>
  );
}
```

## ğŸ” SÃ©curitÃ©

### Middleware de Protection
- VÃ©rification des cookies de session
- Redirection automatique vers `/auth/login`
- Protection des routes `/dashboard` et `/admin`

### VÃ©rification des RÃ´les
- CÃ´tÃ© client : `AdminGuard` et `AdminLink`
- CÃ´tÃ© serveur : Utilities dans `auth-utils.ts`
- Base de donnÃ©es : Contraintes sur le champ `role`

## ğŸ¨ Design

### ThÃ¨me de Charte
- **Couleur primaire** : #752D8B (violet Sagga)
- **Variables CSS** : ConfigurÃ©es dans `globals.css`
- **Mode sombre** : Support automatique

### Pages d'Authentification
- **Layout split-screen** : DÃ©coratif + formulaire
- **Animations** : Fade-in, logo pulsant
- **Responsive** : Mobile-first design
- **AccessibilitÃ©** : Focus states, navigation clavier

## ğŸ“Š Ã‰tat Actuel

### Base de DonnÃ©es
- âœ… 7 utilisateurs crÃ©Ã©s
- âœ… 1 administrateur (admin@example.com)
- âœ… Structure Prisma fonctionnelle

### Authentification
- âœ… Connexion/Inscription opÃ©rationnelle
- âœ… Sessions persistantes
- âœ… Protection des routes

### Interface
- âœ… Design moderne violet
- âœ… Navigation intelligente
- âœ… Responsive design

## ğŸ”§ Commandes Utiles

```bash
# DÃ©veloppement
npm run dev

# Base de donnÃ©es
npx prisma db push
npx prisma studio

# Gestion des utilisateurs
node scripts/list-users.js
node scripts/make-admin.js <email>
node scripts/test-roles.js
```

## ğŸ¯ Prochaines Ã‰tapes Possibles

1. **Gestion avancÃ©e des rÃ´les** : Ajouter des rÃ´les personnalisÃ©s
2. **Permissions granulaires** : SystÃ¨me de permissions dÃ©taillÃ©es
3. **Interface admin complÃ¨te** : CRUD utilisateurs, statistiques
4. **Audit trail** : Logs des actions administratives
5. **Notifications** : SystÃ¨me d'alertes et notifications

---

*Documentation mise Ã  jour le 10 aoÃ»t 2025*
